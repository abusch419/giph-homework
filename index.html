<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Favorite Movies</title>
  <style type="text/css">
    button,
    div,
    form,
    input {
      margin: 10px;
    }
  </style>
</head>

<body>

  <div class="container">
    <h1>Movie Search</h1>

  
   
    <div id="buttons-view">
 <!-- this is an empty div for storing all of our generated buttons -->

    </div>

        <!-- WE HAVE TO CALL THE preventDefault FUNCTION TO PREVENT THIS FORM FROM SENDING DATA WHEN BUTTON CLICKED -->
    <!-- this automatically makes a form to enter text into  -->
    <form id="movie-form">
      <label for="movie-input">Add a Movie, Yo!</label>
      <input type="text" id="movie-input"><br>

      <!-- Button triggers new movie to be added -->
      <input id="add-movie" type="submit" value="Add a Movie, plese!">
    </form>


    <div id="movies">

      <!-- NEW MOVIE ATTRIBUTES WILL BE ADDED TO THIS DIV  (POSTER, NAME, ACTORS) ETC...!! -->

    </div>

    <!-- JQUERY ADDED HERE -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- js here -->
    <script type="text/javascript">


      // Initial array of movies (dont really need this if we dont want)
      var movies = ["The Matrix", "The Notebook", "Mr. Nobody", "The Lion King"];



      // Function for dumping the JSON content for each button into the div
      function displayMovieInfo() {

        // YOUR CODE GOES HERE!!! HINT: You will need to create a new div to hold the JSON.
        const movieName = $(this).attr("data-name");
        const queryUrl = "https://www.omdbapi.com/?t=" + movieName + "&apikey=trilogy";
        $.ajax({
          url: queryUrl,
          method: "GET"
        }).then(function (response) {
          console.log(response);
          renderMovie(response);
        });
      };

      // first we need to store the data associated with the button to a new variable so we can pass it to our ajax request
      // we can use this.attr("data-name") becuase we assign each generated button a data attribute of the movie name below in our loop
        const movieName = $(this).attr("data-name");


      
      // create a function that will render data from the api/ajax request into the empty movies div 
      function renderMovie(movie) {

        // we are going to put a new div full of movie data inside the exiating empty #movies div
        // first save the new empty div to a variable 
        const movieContainer = $("<div>");
          // append a h2 tag for the movie title and img tag for the poster to the empty div 
        movieContainer.append(`<h2>${movie.Title}</h2>`)
        movieContainer.append(`<img src="${movie.Poster}" />`)
        movieContainer.append(`<p>${movie.Awards}`)
        // then prepend each new batch of movie data in front of the previous one so we see it at top of page 
        $("#movies").prepend(movieContainer)

      }
      // Function for displaying all requested movie buttons to the DOM
      function renderButtons() {

        // wipe existing buttons each time since js will add all existing as well as new buttons if we dont 
        $("#buttons-view").empty();

        // Looping through the array of movies
        for (var i = 0; i < movies.length; i++) {

          // make a new button and save to a variable 
          var a = $("<button>");
          // Adding a class of movie to each new button
          a.addClass("movie");
          // Adding a data-attribute to each new button 
          a.attr("data-name", movies[i]);
          // Providing the initial button text for each button 
          a.text(movies[i]);
          // Adding the button to the buttons-view div
          $("#buttons-view").append(a);
        }
      }

      // This handles us clicking the add movie button 

      $("#add-movie").on("click", function (event) {
        // clear the default behaviour of the form button 
        event.preventDefault();

        // This line grabs the input from the textbox
        var movie = $("#movie-input").val().trim();

        // The movie from the textbox is then added to our array
        movies.push(movie);

        // Call renderButtons which handles the processing of our movie array and regens a movie button for each item in the array 
        renderButtons();

      });

      // click handler for any generated movie button will show ajax/api data on the DOM 
      // becuase we assign a class of .movie to each newly generated button 
      $(document).on("click", ".movie", displayMovieInfo);

      // Calling the renderButtons function to display the intial buttons
      renderButtons();

 
     
    </script>
  </div>
</body>

</html>


